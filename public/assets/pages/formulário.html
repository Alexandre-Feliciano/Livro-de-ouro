<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/style-terciary.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <title>Livro de Ouro - Turma Informática</title>

    <style>
        .editor-quill .ql-container {
            height: 700px !important;
        }
    </style>

</head>

<body>

    <canvas id="matrixCanvas"></canvas>

    <section class="conteiner">

        <h1>Contribua e deixe seu recado!</h1>

        <div id="alert-copiar"></div>

        <div id="conteiner-pay">
            <h3 id="valor"></h3>
            <img id="qrcode" class="qrcode_img" alt="QR_CODE" src="../img/Pix turma (1).jpg">
            <textarea id="link_pix"
                readonly>00020126450014br.gov.bcb.pix0123turmainfo1814@gmail.com5204000053039865802BR5925ALEXANDRE FELICIANO SANTO6009Sao Paulo62290525REC68ECF7E3EE90A0930035796304CC05</textarea>

        </div>

        <form id="form-recado" action="../php/process_bd.php" method="POST">

            <input type="text" name="nome-recado" maxlength="40" id="Nome-recado" required placeholder="Seu Nome">

            <div class="editor-quill"></div>
            <textarea name="recado" id="recado" style="display:none"></textarea>

            <button type="button" class="Assinar-btn" id="btnAssinar">Assinar</button>

        </form>

    </section>

    <!-- <script src="../JS/pix.js"></script> -->
    <script src="../JS/copy.js"></script>
    <script src="../JS/script.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <script>
        
        document.addEventListener("DOMContentLoaded", () => {
        const limite = 400;
        const quill = new Quill('.editor-quill', { theme: 'snow' });

        quill.on("text-change", () => {
            if (quill.getLength() > limite + 1) {
                quill.deleteText(limite, quill.getLength());
            }
        });

        const form = document.getElementById('form-recado');
        const nomeInput = document.getElementById('Nome-recado');
        const btn = document.getElementById('btnAssinar');

    btn.addEventListener('click', async (e) => {
        e.preventDefault();
        e.stopPropagation();

        const nome = nomeInput.value.trim();
        const recadoHTML = quill.root.innerHTML.trim();
        const recadoTexto = quill.getText().trim();

        if (!nome || !recadoTexto) {
            alert("Preencha todos os campos para o envio do recado!");
            return;
        }

        const formData = new FormData();
        formData.append("nome-recado", nome);
        formData.append("recado", recadoHTML);

            try {
                const response = await fetch("../php/process_bd.php", {
                    method: "POST",
                    body: formData
                });

                if (response.ok) {
                    alert("Recado enviado com sucesso!");
                    nomeInput.value = "";
                    quill.setText("");
                } else {
                    alert("Erro ao enviar recado. Tente novamente.");
                }
            } catch (err) {
                console.error(err);
                alert("Erro de conexão. Tente novamente.");
            }
        });
    });
    </script>
</body>

</html>